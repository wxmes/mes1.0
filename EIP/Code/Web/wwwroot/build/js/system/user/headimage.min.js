function imagesAjax(n){UtilAjaxPostWait("/User/SaveHeadImage",{id:n},function(t){if(DialogAjaxResult(t),t.ResultSign===0){$(".img-circle").attr("src",n);var i=window.localStorage;i.HeadImage=n;dialog.close()}})}(function(){function n(n){var i=document.createElement("canvas"),t=i.getContext("2d"),r=n.width,u=n.height;return i.width=r,i.height=u,t.imageSmoothingEnabled=!0,t.drawImage(n,0,0,r,u),t.globalCompositeOperation="destination-in",t.beginPath(),t.arc(r/2,u/2,Math.min(r,u)/2,0,2*Math.PI,!0),t.fill(),i}window.addEventListener("DOMContentLoaded",function(){var r=document.getElementById("image"),u=document.getElementById("button"),t=document.getElementById("result"),i=!1,f=new Cropper(r,{aspectRatio:1,viewMode:1,ready:function(){i=!0}});u.onclick=function(){var u,e,r;i&&(u=f.getCroppedCanvas(),e=n(u),r=document.createElement("img"),r.src=e.toDataURL(),t.innerHTML="",t.appendChild(r))}})})();$("#avatarInput").on("change",function(n){var t=$(n.target),i=t[0].files[0].size/1024;if(i>5120)return DialogTipsMsgError("'图片过大，请重新选择!",1e3),$(".avatar-wrapper").childre().remove(),!1;if(this.files[0].type.match(/image.*/)){var r=document.querySelector("#avatar-name"),u=document.querySelector("#avatarInput").value,f=u,e=f.match(/[^\\]+\.[^\(]+/i);r.innerHTML=e}else alert("请选择正确的图片!")});$("#headImageSubmit").on("click",function(){var n=document.getElementById("imageHead");html2canvas(n,{allowTaint:!0,taintTest:!1,onrendered:function(n){n.id="mycanvas";var t=n.toDataURL("image/jpeg"),i=document.createElement("img");i.src=t;imagesAjax(t)}})});