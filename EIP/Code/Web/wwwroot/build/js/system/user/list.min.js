function initEvent(){$("#reload").click(function(){reload(!0)});$("#arrowin").click(function(){arrowin()});$("#search").click(function(){getGridData()})}function detail(){GridIsSelectLayTable(tableObj,options.table.name,function(n){DialogOpen("/System/User/Detail?id="+n[options.table.key],"查看详情"+options.dialog.title+"-"+n.Name,options.dialog.width)},!0)}function initGird(){layui.use("table",function(){tableObj=layui.table;$grid=tableObj.render({elem:"#"+options.table.name,size:"sm",method:"post",url:options.url.get,cols:[[{type:"checkbox",fixed:"left",width:30},{title:"序号",type:"numbers",fixed:"left"},{field:"Code",title:"登录名",width:150,sort:!0,fixed:"left"},{field:"Name",title:"名称",width:100,sort:!0,fixed:"left"},{field:"OrganizationNames",title:"归属单位",width:"40%",sort:!0},{field:"IsFreeze",title:"冻结",width:80,align:"center",templet:"#templetFreeze"},{field:"Mobile",title:"手机号码",width:100},{field:"CreateTime",title:"创建时间",width:120,align:"center"},{field:"CreateUserName",title:"创建人",width:80},{field:"UpdateTime",title:"修改时间",width:120,align:"center"},{field:"UpdateUserName",title:"修改人",width:80},{field:"LastVisitTime",title:"最后登录时间",width:150},{field:"Remark",title:"备注",width:250}]],limit:50,limits:[50,100,200,500],where:{privilegeMaster:Language.privilegeMaster.organization,privilegeMasterValue:treeId,sidx:"u.CreateTime"},even:!0,height:Language.mainHeight,page:!0})})}function initTree(){UtilAjaxPostAsync("/User/GetOrganizationDataTree",{},function(n){$tree.jstree({core:{data:n,strings:{"Loading ...":"正在加载..."}},plugins:["types","dnd"],types:{"default":{icon:"fa  fa-file-text-o"}}}).bind("activate_node.jstree",function(n,t){treeId=t.node.id;$orgId.val(treeId);getGridData()})})}function getGridData(){$grid.reload({where:{filters:getFilters($("#user-search")),privilegeMaster:Language.privilegeMaster.organization,privilegeMasterValue:treeId,sidx:"u.CreateTime"},page:{curr:1}})}function add(){DialogOpen(options.url.edit,"新增"+options.dialog.title,options.dialog.width)}function edit(){GridIsSelectLayTable(tableObj,options.table.name,function(n){DialogOpen(options.url.edit+"?id="+n[options.table.key],"编辑"+options.dialog.title+"-"+n.Name,options.dialog.width)},!0)}function del(){GridIsSelectLayTableIds(tableObj,options.table.name,options.table.key,function(n){DialogConfirm(Language.common.deletemsg,function(){UtilAjaxPostWait(options.url.delete,{id:n},perateStatus)})},!1)}function resetPassword(){GridIsSelectLayTable(tableObj,options.table.name,function(n){var t=BootstrapDialog.show({size:BootstrapDialog.SIZE_SMALL,title:"请输入重置密码-"+n.Name,message:$('<textarea id="resetPassword" class="form-control" placeholder="请输入重置密码..." value="">123456<\/textarea>'),buttons:[{label:"确定",cssClass:"eip-btn",hotkey:13,action:function(){t.close();UtilAjaxPostWait("/User/ResetPassword",{id:n[options.table.key],EncryptPassword:$("#resetPassword").val()},function(n){DialogAjaxResult(n);n.ResultSign===0&&(reload(!1),t.close())})}}]})},!0)}function perateStatus(n){DialogAjaxResult(n);n.ResultSign===0&&reload(!1)}function reload(n){n&&(treeId=null,$orgId.val(treeId));$tree.jstree("destroy");initTree();getGridData()}function menuPermission(){GridIsSelectLayTable(tableObj,options.table.name,function(n){DialogOpen("/System/Permission/Menu?privilegeMasterValue="+n.UserId+"&privilegeMaster="+Language.privilegeMaster.user,"模块权限授权-"+n.Name,380)},!0)}function functionPermission(){GridIsSelectLayTable(tableObj,options.table.name,function(n){DialogOpen("/System/Permission/Button?privilegeMasterValue="+n.UserId+"&privilegeMaster="+Language.privilegeMaster.user,"模块按钮权限授权-"+n.Name,810)},!0)}function arrowin(){expand?($tree.jstree().close_all(),expand=!1,$arrowin.html("展开").attr("class","fa fa-folder-open")):($tree.jstree().open_all(),expand=!0,$arrowin.html("折叠").attr("class","fa fa-folder"))}var options={url:{get:Language.common.apiurl+"/User/GetPagingUser",edit:"/System/User/Edit","delete":"/User/DeleteUser"},dialog:{width:590,title:"用户"},table:{name:"list",key:"UserId"}},$grid,tableObj,$tree,$arrowin,$orgId,treeId=Language.common.guidorg,expand;$(function(){$tree=$("#tree");$arrowin=$("i","#arrowin");$orgId=$("#PrivilegeMasterValue");$tree.height(Language.mainHeight);$tree.slimScroll({height:Language.mainHeight});initTree();initGird();initEvent()});expand=!0;