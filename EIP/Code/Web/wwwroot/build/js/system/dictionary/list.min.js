function initEvent(){$reload.click(function(){reload(!0)});$arrowin.click(function(){arrowin()});$search.click(function(){getGridData()})}function initGird(){layui.use("table",function(){tableObj=layui.table;$grid=tableObj.render({elem:"#"+options.table.name,size:"sm",method:"post",url:options.url.get,cols:[[{type:"checkbox",fixed:"left",width:30},{title:"序号",type:"numbers",fixed:"left"},{field:"Name",title:"名称",width:"200",sort:!0,fixed:"left"},{field:"ParentNames",title:"层级",width:"40%",sort:!0},{field:"Value",title:"值",sort:!0},{field:"IsFreeze",title:"冻结",width:80,align:"center",templet:"#templetFreeze"},{field:"OrderNo",title:"排序",sort:!0,align:"center"},{field:"Remark",title:"备注",sort:!0}]],even:!0,height:Language.mainHeight,page:!1})})}function initTree(){UtilAjaxPostAsync("/Dictionary/GetDictionaryTree",{},function(n){$tree.jstree({core:{data:n,strings:{"Loading...":"正在努力加载中..."}},plugins:["types"],types:{"default":{icon:"fa fa-file-text-o"}}}).bind("activate_node.jstree",function(n,t){treeId=t.node.id;getGridData()}).bind("loaded.jstree",function(){treeId!==null&&$tree.jstree("select_node",treeId,!0)})})}function getGridData(){$grid.reload({where:{id:treeId,filters:getFilters($searchFilters)}})}function add(){DialogOpen(options.url.edit,"新增"+options.dialog.title,options.dialog.width)}function edit(){GridIsSelectLayTable(tableObj,options.table.name,function(n){DialogOpen(options.url.edit+"?id="+n[options.table.key]+"&iscopy=0","编辑"+options.dialog.title+"-"+n.Name,options.dialog.width)},!0)}function del(){GridIsSelectLayTableIds(tableObj,options.table.name,options.table.key,function(n){DialogConfirm(Language.common.deletemsg,function(){UtilAjaxPostWait(options.url.delete,{id:n},perateStatus)})},!1)}function perateStatus(n){DialogAjaxResult(n);n.ResultSign===0&&reload(!1)}function reload(n){n&&(treeId=null);$tree.jstree("destroy");initTree();getGridData()}function copy(){GridIsSelectLayTable(tableObj,options.table.name,function(n){DialogOpen(options.url.edit+"?id="+n[options.table.key]+"&iscopy=1","复制"+options.dialog.title+"-"+n.Name,options.dialog.width)},!0)}function arrowin(){expand?($tree.jstree().close_all(),expand=!1,$arrowini.html("展开").attr("class","fa fa-folder-open")):($tree.jstree().open_all(),expand=!0,$arrowini.html("折叠").attr("class","fa fa-folder"))}var options={url:{get:Language.common.apiurl+"/Dictionary/GetDictionariesByParentId",edit:"/System/Dictionary/Edit","delete":"/Dictionary/DeleteDictionary"},dialog:{width:610,title:"字典"},table:{name:"list",key:"DictionaryId"}},$grid,$tree,$arrowin,$arrowini,$search,tableObj,$reload,$searchFilters,$list,treeId=null,expand;$(function(){$tree=$("#tree");$arrowin=$("#arrowin");$arrowini=$("i",$arrowin);$reload=$("#reload");$search=$("#search");$searchFilters=$("#search-filters");$tree.height(Language.mainHeight);$tree.slimScroll({height:Language.mainHeight});initTree();initGird();initEvent()});expand=!0;