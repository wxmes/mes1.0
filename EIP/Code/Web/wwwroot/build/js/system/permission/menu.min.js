function initMenuTree(){UtilAjaxPostAsync("/Menu/GetHaveMenuPermissionMenu",{},function(n){$tree.jstree({core:{data:n,check_callback:!0,multiple:!0,strings:{"Loading ...":"正在加载..."}},plugins:["types","checkbox"],checkbox:{three_state:!1,cascade:"undetermined"},types:{"default":{icon:"fa fa-tasks"}}}).bind("click.jstree",function(){var t=$tree.jstree().get_checked(!0),n;json="";$.each(t,function(n,t){json+='{"P":"'+t.id+'"},'});n=$tree.jstree().get_undetermined();$.each(n,function(n,t){json+='{"P":"'+t+'"},'});json!=""&&(json=json.substring(0,json.length-1));json="["+json+"]"}).on("loaded.jstree",function(){$tree.jstree("deselect_all",!0);UtilAjaxPost("/Permission/GetPermissionByPrivilegeMasterValue",{privilegeMasterValue:$("#privilegeMasterValue").val(),privilegeMaster:$("#privilegeMaster").val(),PrivilegeAccess:Language.privilegeAccess.menu},function(n){json="";$.each(n,function(n,t){json+='{"P":"'+t.PrivilegeAccessValue+'"},';$tree.jstree("check_node",t.PrivilegeAccessValue,!0)});json!=""&&(json=json.substring(0,json.length-1));json="["+json+"]"})})})}function arrowin(){expand?($tree.jstree().close_all(),expand=!1,$arrowin.html("展开").attr("class","fa fa-folder-open"),$arrowin.parent().attr("title","展开")):($tree.jstree().open_all(),expand=!0,$arrowin.html("折叠").attr("class","fa fa-folder"),$arrowin.parent().attr("title","折叠"))}function selectall(){checkAll?($tree.jstree().select_all(),checkAll=!1,$select.html("反选").attr("class","fa fa-circle-thin"),$select.parent().attr("title","反选")):($tree.jstree().deselect_all(),checkAll=!0,$select.html("全选").attr("class","fa fa-check-circle-o"),$select.parent().attr("title","全选"))}function formSubmit(){DialogTipsMsgWait("正在处理中");UtilAjaxPostWait("/Permission/SavePermission",{privilegeAccess:Language.privilegeAccess.menu,menuPermissions:json,privilegeMasterValue:$("#privilegeMasterValue").val(),privilegeMaster:$("#privilegeMaster").val()},function(n){DialogAjaxResult(n);dialog.close()})}var $tree,$select,$arrowin,json,expand,checkAll;$(function(){$tree=$("#menuTree");$select=$("#select");$arrowin=$("#arrowin");initMenuTree()});json="";expand=!0;checkAll=!0;